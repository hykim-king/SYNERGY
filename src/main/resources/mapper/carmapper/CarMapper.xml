<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pcwk.ehr.mapper.CarMapper">
<select id="getCarCode" resultType="java.lang.Integer">
        SELECT CAR_CODE.NEXTVAL FROM dual
    </select>
  <!-- doSave -->
<insert id="doSave" parameterType="com.pcwk.ehr.car.CarDTO">
  INSERT INTO CAR (
    CAR_CODE, PRODUCT_NAME, CAR_MF, CARTYPE, ORG_FN, MOD_FN, PATH, PRICE, FUEL, EF,
    ENGINE, DPM, BATTERY, MF_DT, REG_DT, REG_ID, MOD_DT, MOD_ID
  ) VALUES (
    #{carCode}, #{productName}, #{carMf}, #{cartype}, #{orgFn}, #{modFn}, #{path}, #{price}, #{fuel}, #{ef},
    #{engine}, #{dpm}, #{battery}, #{mfDt}, #{regDt, jdbcType=DATE}, #{regId}, #{modDt, jdbcType=DATE}, #{modId}
  )
</insert>

  <!-- doUpdate -->
  <update id="doUpdate" parameterType="com.pcwk.ehr.car.CarDTO">
    UPDATE CAR
       SET PRODUCT_NAME = #{productName},
           CAR_MF = #{carMf},
           CARTYPE = #{cartype},
           ORG_FN = #{orgFn},
           MOD_FN = #{modFn},
           PATH = #{path},
           PRICE = #{price},
           FUEL = #{fuel},
           EF = #{ef},
           ENGINE = #{engine},
           DPM = #{dpm},
           BATTERY = #{battery},
           MF_DT = #{mfDt},
           REG_DT = #{regDt, jdbcType=DATE},
           REG_ID = #{regId},
           MOD_DT = #{modDt, jdbcType=DATE},
           MOD_ID = #{modId}
     WHERE CAR_CODE = #{carCode}
  </update>

  <!-- doDelete -->
  <delete id="doDelete" parameterType="com.pcwk.ehr.car.CarDTO">
    DELETE FROM CAR WHERE CAR_CODE = #{carCode}
  </delete>

  <!-- doSelectOne -->
  <select id="doSelectOne" parameterType="com.pcwk.ehr.car.CarDTO" resultType="com.pcwk.ehr.car.CarDTO">
    SELECT
      CAR_CODE AS carCode, PRODUCT_NAME AS productName, CAR_MF AS carMf, CARTYPE AS cartype,
      ORG_FN AS orgFn, MOD_FN AS modFn, PATH AS path, PRICE AS price, FUEL AS fuel, EF AS ef,
      ENGINE AS engine, DPM AS dpm, BATTERY AS battery, MF_DT AS mfDt, REG_DT AS regDt,
      REG_ID AS regId, MOD_DT AS modDt, MOD_ID AS modId
    FROM CAR
    WHERE CAR_CODE = #{carCode}
  </select>

  <!-- doRetrieve: 예시 (페이지, 검색 추가 필요시 param의 필드 사용) -->
  <select id="doRetrieve" parameterType="com.pcwk.ehr.cmn.DTO" resultType="com.pcwk.ehr.car.CarDTO">
    SELECT
      CAR_CODE AS carCode, PRODUCT_NAME AS productName, CAR_MF AS carMf, CARTYPE AS cartype,
      ORG_FN AS orgFn, MOD_FN AS modFn, PATH AS path, PRICE AS price, FUEL AS fuel, EF AS ef,
      ENGINE AS engine, DPM AS dpm, BATTERY AS battery, MF_DT AS mfDt, REG_DT AS regDt,
      REG_ID AS regId, MOD_DT AS modDt, MOD_ID AS modId
    FROM CAR
    <where>
      <if test="searchDiv != null and searchDiv != '' and searchWord != null and searchWord != ''">
        <choose>
          <when test="searchDiv == 'productName'">
            PRODUCT_NAME LIKE '%' || #{searchWord} || '%'
          </when>
          <when test="searchDiv == 'carMf'">
            CAR_MF LIKE '%' || #{searchWord} || '%'
          </when>
          <!-- 필요한 검색필드 추가 -->
        </choose>
      </if>
    </where>
    ORDER BY CAR_CODE DESC
    <!-- 페이지네이션 예시: <if test="pageSize != null">OFFSET #{pageSize} ROWS FETCH NEXT #{pageSize} ROWS ONLY</if> -->
  </select>

  <!-- 기타 (테스트용) -->
  <delete id="deleteAll">
    DELETE FROM CAR
  </delete>

  <select id="getCount" resultType="int">
    SELECT COUNT(*) FROM CAR
  </select>
</mapper>
