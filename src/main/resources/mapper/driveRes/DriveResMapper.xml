<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pcwk.ehr.mapper.DriveResMapper">

  <insert id="doSave" parameterType="com.pcwk.ehr.drive.DriveResDTO">
   <selectKey keyProperty="resNo"
             resultType="int"
             order="BEFORE">
    SELECT DRIVE_RES_SEQ.NEXTVAL
    FROM DUAL
  </selectKey>
    INSERT INTO drive_res (
      res_no, id, name, phone,
      car_code, retailer_code, drive_date,
      reg_dt, reg_id, mod_dt, mod_id
    ) VALUES (
      #{resNo}, #{id}, #{name}, #{phone},
      #{carCode}, #{retailerCode}, #{driveDate},
      SYSDATE, #{regId}, SYSDATE, #{modId}
    )
  </insert>

  <update id="doUpdate" parameterType="com.pcwk.ehr.drive.DriveResDTO">
    UPDATE drive_res
    SET
      name = #{name},
      phone = #{phone},
      car_code = #{carCode},
      retailer_code = #{retailerCode},
      drive_date = #{driveDate},
      mod_dt = SYSDATE,
      mod_id = #{modId}
    WHERE res_no = #{resNo}
  </update>

  <delete id="doDelete" parameterType="com.pcwk.ehr.drive.DriveResDTO">
    DELETE FROM drive_res
    WHERE res_no = #{resNo}
  </delete>

<resultMap id="DriveResResult" type="com.pcwk.ehr.drive.DriveResDTO">
  <id     column="res_no"         property="resNo"/>
  <result column="id"             property="id"/>
  <result column="name"           property="name"/>
  <result column="phone"          property="phone"/>
  <result column="car_code"       property="carCode"/>
  <result column="retailer_code"  property="retailerCode"/>
  <result column="drive_date"     property="driveDate"/>
  <result column="reg_dt"         property="regDt"/>
  <result column="reg_id"         property="regId"/>
  <result column="mod_dt"         property="modDt"/>
  <result column="mod_id"         property="modId"/>
</resultMap>


  <select id="doSelectOne" parameterType="com.pcwk.ehr.drive.DriveResDTO"  resultMap="DriveResResult">
    SELECT *
    FROM drive_res
    WHERE res_no = #{resNo}
  </select>

  <select id="doRetrieve" parameterType="com.pcwk.ehr.cmn.DTO" resultMap="DriveResResult">
    SELECT *
    FROM drive_res
    ORDER BY reg_dt DESC
  </select>

</mapper>