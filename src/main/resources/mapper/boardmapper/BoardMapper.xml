<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pcwk.ehr.boardmapper.BoardMapper">

    <!-- 단건 조회 -->
    <select id="doSelectOne" parameterType="int" resultType="com.pcwk.ehr.board.BoardDTO">
        SELECT *
        FROM board
        WHERE board_code = #{boardCode}
    </select>

    <!-- 전체 목록 조회 (페이징 + 검색) -->
    <select id="doRetrieve" parameterType="com.pcwk.ehr.board.BoardMapperDTO"
            resultType="com.pcwk.ehr.board.BoardDTO">
        SELECT *
        FROM (
            SELECT ROWNUM AS rnum, b.*
            FROM (
                SELECT *
                FROM board
                WHERE 
                    (#{searchDiv} IS NULL OR 
                     (#{searchDiv} = 'title' AND title LIKE '%' || #{searchWord} || '%') OR
                     (#{searchDiv} = 'nickname' AND nickname LIKE '%' || #{searchWord} || '%') OR
                     (#{searchDiv} = 'contents' AND contents LIKE '%' || #{searchWord} || '%')
                    )
                ORDER BY reg_dt DESC
            ) b
            <![CDATA[
            WHERE ROWNUM <= #{pageNo} * #{pageSize}
        )
        WHERE rnum > (#{pageNo} - 1) * #{pageSize}
        ]]>
    </select>

    <!-- 등록 -->
    <insert id="doSave" parameterType="com.pcwk.ehr.board.BoardDTO">
        INSERT INTO board (
            board_code, title, contents, id, nickname, read_cnt,
            reg_dt, reg_id, mod_dt, mod_id
        )
        VALUES (
            #{boardCode}, #{title}, #{contents}, #{id}, #{nickname}, #{readCnt},
            #{regDt}, #{regId}, #{modDt}, #{modId}
        )
    </insert>

    <!-- 수정 -->
    <update id="doUpdate" parameterType="com.pcwk.ehr.board.BoardDTO">
        UPDATE board
        SET
            title = #{title},
            contents = #{contents},
            mod_dt = #{modDt},
            mod_id = #{modId}
        WHERE board_code = #{boardCode}
    </update>

    <!-- 삭제 -->
    <delete id="doDelete" parameterType="int">
        DELETE FROM board
        WHERE board_code = #{boardCode}
    </delete>

    <!-- 전체 건수 -->
    <select id="getCount" resultType="int">
        SELECT COUNT(*) FROM board
    </select>

    <!-- 전체 삭제 -->
    <delete id="deleteAll">
        DELETE FROM board
    </delete>

</mapper>